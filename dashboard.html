<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workplace Scheduler - Dashboard</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body class="light">
    <header class="header">
        <h1>Dashboard</h1>
        <div>
            <span id="userEmail"></span>
            <span id="userRole" class="user-role"></span>
            <button id="themeToggle" class="theme-btn admin-only">ğŸŒ™ Dark Mode</button>
            <button id="myProfile" class="feature-btn">ğŸ‘¤ Profile</button>
            <button id="manageUsers" class="admin-btn admin-only">ğŸ‘¥ Manage Users</button>
            <button id="logout" class="logout-btn">Logout</button>
        </div>
    </header>
    
    <div class="container">
        <!-- Welcome Card -->
        <div class="card">
            <h2>Welcome back, <span id="welcomeName"></span>! ğŸ‘‹</h2>
            <p>You are successfully logged in!</p>
            <p><strong>Account Type:</strong> <span id="accountType"></span></p>
            <p><strong>Last Login:</strong> <span id="lastLogin"></span></p>
        </div>

        <!-- Features Grid -->
        <div class="card">
            <h2>ğŸš€ Quick Actions</h2>
            <div class="features-grid">
                <div class="feature-card" data-modal="profileModal">
                    <div class="feature-icon">ğŸ‘¤</div>
                    <div class="feature-title">My Profile</div>
                    <div class="feature-desc">View and manage your account information</div>
                </div>
                
                <div class="feature-card" data-modal="activityModal">
                    <div class="feature-icon">ğŸ“Š</div>
                    <div class="feature-title">Activity Log</div>
                    <div class="feature-desc">Track your recent activities and sessions</div>
                </div>
                
                <div class="feature-card" data-modal="settingsModal">
                    <div class="feature-icon">âš™ï¸</div>
                    <div class="feature-title">Settings</div>
                    <div class="feature-desc">Customize your dashboard preferences</div>
                </div>
                
                <div class="feature-card admin-only" data-modal="analyticsModal">
                    <div class="feature-icon">ğŸ“ˆ</div>
                    <div class="feature-title">Analytics</div>
                    <div class="feature-desc">View platform statistics and insights</div>
                </div>

                <div class="feature-card admin-only" data-modal="workplaceManagementModal">
                    <div class="feature-icon">ğŸ—ï¸</div>
                    <div class="feature-title">Workplace Management</div>
                    <div class="feature-desc">Manage all workplaces, workers, and schedules</div>
                </div>
            </div>
        </div>
        
        <!-- Admin Panel -->
        <div class="card admin-only">
            <h2>ğŸ”§ Admin Panel</h2>
            <p>This section is only visible to administrators.</p>
            <p>As an admin, you can:</p>
            <ul style="margin-left: 2rem; margin-top: 1rem;">
                <li>Toggle between light and dark themes</li>
                <li>Manage user accounts and permissions</li>
                <li>View all registered users</li>
                <li>Promote/demote admin status</li>
                <li>Delete user accounts</li>
                <li>View platform analytics</li>
                <li><strong>ğŸ¢ Manage all 3 workplaces</strong></li>
                <li><strong>ğŸ‘¥ Manage workplace workers</strong></li>
                <li><strong>ğŸ“… Generate and view schedules</strong></li>
                <li><strong>â° Manage hours of operation</strong></li>
                <li><strong>ğŸš¨ Check last-minute availability</strong></li>
                <li><strong>âœï¸ Override shift assignments</strong></li>
            </ul>
        </div>

        <!-- User Management Section -->
        <div id="userManagement" class="card admin-only" style="display: none;">
            <button id="closeUserManagement" class="close-btn">âœ• Close</button>
            <h2>ğŸ‘¥ User Management</h2>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalUsers">-</div>
                    <div class="stat-label">Total Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalAdmins">-</div>
                    <div class="stat-label">Administrators</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalRegularUsers">-</div>
                    <div class="stat-label">Regular Users</div>
                </div>
            </div>

            <div id="usersLoading" class="loading">Loading users...</div>
            <div id="usersContainer" style="display: none;">
                <table class="user-table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" data-close-modal="profileModal">Ã—</button>
            <h2>ğŸ‘¤ My Profile</h2>
            <div class="profile-info">
                <div class="info-item">
                    <div class="info-label">Email Address</div>
                    <div id="profileEmail">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Account Type</div>
                    <div id="profileType">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Member Since</div>
                    <div id="profileCreated">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">User ID</div>
                    <div id="profileId">-</div>
                </div>
            </div>
        </div>
    </div>

    <div id="activityModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" data-close-modal="activityModal">Ã—</button>
            <h2>ğŸ“Š Recent Activity</h2>
            <div id="activityLog">
                <div class="activity-item">
                    <div>ğŸ” Logged in successfully</div>
                    <div class="activity-time" id="loginTime">-</div>
                </div>
                <div class="activity-item">
                    <div>ğŸ‘¤ Profile viewed</div>
                    <div class="activity-time">Just now</div>
                </div>
                <div class="activity-item admin-only">
                    <div>ğŸ‘¥ User management accessed</div>
                    <div class="activity-time">Earlier today</div>
                </div>
                <div class="activity-item admin-only">
                    <div>ğŸ¢ Workplace management accessed</div>
                    <div class="activity-time">Recently</div>
                </div>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" data-close-modal="settingsModal">Ã—</button>
            <h2>âš™ï¸ Settings</h2>
            <p><strong>Theme Preference:</strong></p>
            <p>Light/Dark theme toggle is available in the header.</p>
            <p style="margin-top: 1rem;"><strong>Notifications:</strong></p>
            <p>Dashboard notifications are currently enabled.</p>
            <p style="margin-top: 1rem;"><strong>Language:</strong></p>
            <p>English (US) - Default</p>
        </div>
    </div>

    <div id="analyticsModal" class="modal admin-only">
        <div class="modal-content">
            <button class="modal-close" data-close-modal="analyticsModal">Ã—</button>
            <h2>ğŸ“ˆ Platform Analytics</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="analyticsUsers">-</div>
                    <div class="stat-label">Total Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="analyticsLogins">-</div>
                    <div class="stat-label">Today's Logins</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="analyticsNewUsers">-</div>
                    <div class="stat-label">New This Week</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Workplace Management Modal -->
    <div id="workplaceManagementModal" class="modal admin-only">
        <div class="modal-content">
            <button class="modal-close" data-close-modal="workplaceManagementModal">Ã—</button>
            <h2>ğŸ—ï¸ Workplace Management</h2>
            
            <!-- Workplace Selector -->
            <h3>Select Workplace</h3>
            <div class="workplace-selector">
                <div class="workplace-card" data-workplace="esports_lounge">
                    <div class="workplace-icon">ğŸ®</div>
                    <div class="workplace-name">eSports Lounge</div>
                    <div class="workplace-desc">Gaming tournaments and casual play</div>
                </div>
                
                <div class="workplace-card" data-workplace="esports_arena">
                    <div class="workplace-icon">ğŸŸï¸</div>
                    <div class="workplace-name">eSports Arena</div>
                    <div class="workplace-desc">Competitive gaming events</div>
                </div>
                
                <div class="workplace-card" data-workplace="it_service_center">
                    <div class="workplace-icon">ğŸ’»</div>
                    <div class="workplace-name">IT Service Center</div>
                    <div class="workplace-desc">Technical support and services</div>
                </div>
            </div>

            <!-- Workplace Management Content -->
            <div id="workplaceContent" style="display: none;">
                <hr style="margin: 2rem 0;">
                <h3 id="selectedWorkplaceName">-</h3>
                
                <!-- Tabs -->
                <div class="tabs">
                    <div class="tab active" data-tab="workers">ğŸ‘¥ Workers</div>
                    <div class="tab" data-tab="schedule">ğŸ“… Schedule</div>
                    <div class="tab" data-tab="hours">â° Hours</div>
                    <div class="tab" data-tab="lastMinute">ğŸš¨ Last Minute</div>
                </div>

                <!-- Workers Tab -->
                <div id="workersTab" class="tab-content active">
                    <h4>Manage Workers</h4>
                    
                    <!-- Add Worker Form -->
                    <div class="worker-form">
                        <div class="form-group">
                            <label>First Name *</label>
                            <input type="text" id="workerFirstName" placeholder="John">
                        </div>
                        <div class="form-group">
                            <label>Last Name *</label>
                            <input type="text" id="workerLastName" placeholder="Doe">
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="workerEmail" placeholder="john@example.com">
                        </div>
                        <div class="form-group">
                            <label>Work Study</label>
                            <select id="workerWorkStudy">
                                <option value="No">No</option>
                                <option value="Yes">Yes</option>
                            </select>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>Availability</label>
                            <textarea id="workerAvailability" rows="3" placeholder="Monday 12:00-15:00, Tuesday 20:00-00:00"></textarea>
                        </div>
                        <div class="form-group">
                            <button id="addWorkerBtn" class="add-worker-btn">â• Add Worker</button>
                        </div>
                    </div>

                    <!-- Workers List -->
                    <div id="workersLoading" class="loading">Loading workers...</div>
                    <div id="workersContainer" style="display: none;">
                        <table class="user-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Work Study</th>
                                    <th>Availability</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="workersTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Schedule Tab -->
                <div id="scheduleTab" class="tab-content">
                    <h4>Schedule Management</h4>
                    
                    <!-- Schedule Options -->
                    <div class="schedule-options">
                        <div class="schedule-option-card" id="generateScheduleOption">
                            <div class="schedule-option-icon">ğŸ”„</div>
                            <div class="schedule-option-title">Generate New Schedule</div>
                            <div>Create a new schedule with specific settings</div>
                        </div>
                        
                        <div class="schedule-option-card" id="viewCurrentScheduleOption">
                            <div class="schedule-option-icon">ğŸ‘ï¸</div>
                            <div class="schedule-option-title">View Current Schedule</div>
                            <div>See the published active schedule</div>
                        </div>
                        
                        <div class="schedule-option-card" id="shiftOverrideOption">
                            <div class="schedule-option-icon">âœï¸</div>
                            <div class="schedule-option-title">Shift Override</div>
                            <div>Manually modify worker assignments</div>
                        </div>
                        
                        <div class="schedule-option-card" id="scheduleHistoryOption">
                            <div class="schedule-option-icon">ğŸ—‚ï¸</div>
                            <div class="schedule-option-title">Schedule History</div>
                            <div>View and manage past schedules</div>
                        </div>
                    </div>
                    
                    <!-- Generate Schedule Form (initially hidden) -->
                    <div id="generateScheduleForm" class="schedule-generation-form" style="display: none;">
                        <h5>Generate New Schedule</h5>
                        <p>Configure settings for schedule generation:</p>
                        
                        <div class="form-group" style="margin-top: 1rem;">
                            <label>Maximum Hours Per Worker:</label>
                            <input type="number" id="maxHoursPerWorker" min="1" max="40" value="20">
                        </div>
                        
                        <div class="form-group">
                            <label>Maximum Workers Per Shift:</label>
                            <input type="number" id="maxWorkersPerShift" min="1" max="10" value="2">
                        </div>
                        
                        <div class="form-group">
                            <label>Minimum Hours Per Worker:</label>
                            <input type="number" id="minHoursPerWorker" min="0" max="40" value="3">
                        </div>
                        
                        <p style="margin-top: 1rem; font-style: italic;">Note: Work study students will always be assigned exactly 5 hours per week.</p>
                        
                        <div class="schedule-controls">
                            <button id="generateScheduleBtn" class="generate-btn">ğŸ”„ Generate Schedule</button>
                            <button id="cancelGenerateBtn" class="cancel-btn">Cancel</button>
                        </div>
                    </div>
                    
                    <!-- Schedule History Section (initially hidden) -->
                    <div id="scheduleHistorySection" style="display: none;">
                        <h5>Schedule History</h5>
                        <p>View and manage past schedules. Click on a schedule to view it.</p>
                        
                        <div id="scheduleHistoryList" class="schedule-list">
                            <div class="loading">Loading schedule history...</div>
                        </div>
                        
                        <button id="backToScheduleBtn" class="back-btn">Back to Schedule Options</button>
                    </div>
                    
                    <!-- Shift Override Section (initially hidden) -->
                    <div id="shiftOverrideSection" class="shift-override-form" style="display: none;">
                        <h5>Shift Override</h5>
                        <p>Manually adjust worker assignments for specific shifts.</p>
                        
                        <div id="shiftOverrideContent">
                            <p>Loading current schedule...</p>
                        </div>
                        
                        <div class="schedule-controls">
                            <button id="saveOverridesBtn" class="save-btn">ğŸ’¾ Save Changes</button>
                            <button id="cancelOverrideBtn" class="cancel-btn">Cancel</button>
                        </div>
                    </div>
                    
                    <div id="scheduleContent">
                        <p>Select an option above to get started.</p>
                    </div>
                </div>

                <!-- Hours Tab -->
                <div id="hoursTab" class="tab-content">
                    <h4>Hours of Operation</h4>
                    <p>Manage operating hours for this workplace.</p>
                    
                    <div class="hours-form">
                        <h5>Set Operating Hours</h5>
                        <div id="hoursSchedule">
                            <!-- Dynamic hours content will go here -->
                        </div>
                        <button id="saveHoursBtn" class="save-btn">ğŸ’¾ Save Hours</button>
                    </div>
                    
                    <div id="hoursLoading" class="loading">Loading hours...</div>
                    <div id="hoursContent">
                        <!-- Current hours display -->
                    </div>
                </div>
                
                <!-- Last Minute Tab -->
                <div id="lastMinuteTab" class="tab-content">
                    <h4>Last Minute Availability</h4>
                    <p>Check which workers are available for urgent shift coverage.</p>
                    
                    <div class="last-minute-form">
                        <div class="last-minute-title">ğŸš¨ Find Available Workers</div>
                        
                        <div class="last-minute-inputs">
                            <div class="form-group">
                                <label>Day:</label>
                                <select id="lastMinuteDay">
                                    <option value="Monday">Monday</option>
                                    <option value="Tuesday">Tuesday</option>
                                    <option value="Wednesday">Wednesday</option>
                                    <option value="Thursday">Thursday</option>
                                    <option value="Friday">Friday</option>
                                    <option value="Saturday">Saturday</option>
                                    <option value="Sunday">Sunday</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Start Time:</label>
                                <input type="time" id="lastMinuteStart" value="09:00">
                            </div>
                            
                            <div class="form-group">
                                <label>End Time:</label>
                                <input type="time" id="lastMinuteEnd" value="17:00">
                            </div>
                        </div>
                        
                        <button id="checkAvailabilityBtn" class="check-btn">ğŸ” Check Availability</button>
                    </div>
                    
                    <div id="lastMinuteResults" style="display: none;">
                        <h5>Available Workers</h5>
                        <div id="availableWorkersCount" style="margin-bottom: 1rem;"></div>
                        
                        <div id="availableWorkersList" class="available-workers-list">
                            <!-- Available workers will be listed here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/ui.js"></script>
    <script type="module" src="js/users.js"></script>
    <script type="module" src="js/workplaces.js"></script>
    <script type="module" src="js/workers.js"></script>
    <script type="module" src="js/hours.js"></script>
    <script type="module" src="js/schedule.js"></script>
    <script type="module" src="js/availability.js"></script>
</body>
</html>
